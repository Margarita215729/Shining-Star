<!-- Admin Packages Management -->
<div class="admin-header">
    <div class="admin-nav">
        <div class="admin-brand"><a href="/admin" class="logo"><i class="fas fa-star"></i><span>Admin
                    Dashboard</span></a></div>
        <div class="admin-user"><span>Welcome, <%= user.username %></span>
            <form action="/admin/logout" method="POST" style="display:inline;"><button type="submit"
                    class="btn btn-outline btn-sm"><i class="fas fa-sign-out-alt"></i>
                    <%= __('admin.logout') %>
                </button></form>
        </div>
    </div>
</div>
<div class="admin-layout">
    <aside class="admin-sidebar">
        <nav class="admin-menu">
            <ul>
                <li><a href="/admin" class="<%= (currentPage||'').includes('admin-dashboard') ? 'active' : '' %>"><i
                            class="fas fa-tachometer-alt"></i>
                        <%= __('admin.dashboard') %>
                    </a></li>
                <li><a href="/admin/portfolio"
                        class="<%= (currentPage||'').includes('admin-portfolio') ? 'active' : '' %>"><i
                            class="fas fa-images"></i>
                        <%= __('admin.manage_portfolio') %>
                    </a></li>
                <li><a href="/admin/services"
                        class="<%= (currentPage||'').includes('admin-services') ? 'active' : '' %>"><i
                            class="fas fa-broom"></i>
                        <%= __('admin.manage_services') %>
                    </a></li>
                <li><a href="/admin/packages"
                        class="<%= (currentPage||'').includes('admin-packages') ? 'active' : '' %>"><i
                            class="fas fa-box"></i>
                        <%= __('admin.manage_packages') %>
                    </a></li>
            </ul>
        </nav>
    </aside>
    <main class="admin-content">
        <div class="admin-page-header">
            <h1>
                <%= __('admin.manage_packages') %>
            </h1>
            <div>
                <button id="btn-add-package" class="btn btn-primary"><i class="fas fa-plus"></i> Add Package</button>
            </div>
        </div>
        <div class="admin-card">
            <table class="admin-table" id="packages-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Discount</th>
                        <th>Duration</th>
                        <th>Available</th>
                        <th>Services</th>
                        <th style="width:160px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% (packages||[]).forEach(p=> { %>
                        <tr data-id="<%= p.id %>">
                            <td><strong>
                                    <%= p.name[locale] || p.name.en %>
                                </strong><br><small><code><%= p.id %></code></small></td>
                            <td>$<%= p.price %>
                            </td>
                            <td>
                                <%= p.discount %>%
                            </td>
                            <td>
                                <%= p.duration %> min
                            </td>
                            <td><span class="badge <%= p.available ? 'badge-success' : 'badge-muted' %>">
                                    <%= p.available ? 'Yes' : 'No' %>
                                </span></td>
                            <td>
                                <% (p.services||[]).forEach(sid=> { const s=(services||[]).find(x=>x.id===sid); if(s){
                                    %>
                                    <span class="badge">
                                        <%= s.name[locale] || s.name.en %>
                                    </span>
                                    <% }}) %>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline" data-action="edit" data-id="<%= p.id %>"><i
                                        class="fas fa-edit"></i> Edit</button>
                                <button class="btn btn-sm btn-danger" data-action="delete" data-id="<%= p.id %>"><i
                                        class="fas fa-trash"></i> Delete</button>
                            </td>
                        </tr>
                        <% }) %>
                </tbody>
            </table>
        </div>

        <!-- Package Modal -->
        <div id="package-modal" class="modal" style="display:none;">
            <div class="modal-content" style="max-width:820px;">
                <div class="modal-header">
                    <h3 id="package-modal-title">Add Package</h3>
                    <button class="modal-close" id="package-modal-close">Ã—</button>
                </div>
                <div class="modal-body">
                    <form id="package-form">
                        <input type="hidden" id="package-id" />
                        <div class="grid grid-2">
                            <div>
                                <label>Name (EN)</label>
                                <input type="text" id="package-name-en" required />
                            </div>
                            <div>
                                <label>Name (RU)</label>
                                <input type="text" id="package-name-ru" />
                            </div>
                            <div>
                                <label>Name (ES)</label>
                                <input type="text" id="package-name-es" />
                            </div>
                        </div>

                        <div class="grid grid-4">
                            <div>
                                <label>Price (USD)</label>
                                <input type="number" step="0.01" id="package-price" required />
                            </div>
                            <div>
                                <label>Discount (%)</label>
                                <input type="number" step="1" id="package-discount" value="0" />
                            </div>
                            <div>
                                <label>Duration (min)</label>
                                <input type="number" id="package-duration" required />
                            </div>
                            <div>
                                <label>Available</label>
                                <select id="package-available">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid">
                            <div>
                                <label>Services</label>
                                <div class="chip-list" id="package-services">
                                    <% (services||[]).forEach(s=> { %>
                                        <label class="chip">
                                            <input type="checkbox" value="<%= s.id %>">
                                            <span>
                                                <%= s.name[locale] || s.name.en %>
                                            </span>
                                        </label>
                                        <% }) %>
                                </div>
                            </div>
                        </div>

                        <div class="grid">
                            <div>
                                <label>Description (EN)</label>
                                <textarea id="package-description-en" rows="3" required></textarea>
                            </div>
                            <div>
                                <label>Description (RU)</label>
                                <textarea id="package-description-ru" rows="3"></textarea>
                            </div>
                            <div>
                                <label>Description (ES)</label>
                                <textarea id="package-description-es" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="package-cancel">Cancel</button>
                    <button class="btn btn-primary" id="package-save">Save</button>
                </div>
            </div>
        </div>

        <script id="packages-data" type="application/json"><%- JSON.stringify(packages || []) %></script>
        <script id="services-data" type="application/json"><%- JSON.stringify(services || []) %></script>
    </main>
</div>